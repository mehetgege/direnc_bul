<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI OrderBook Sinyal Botu v4.0</title>
<style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0B0E11 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        body.light-theme {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            color: #1e293b;
        }
       
       .header {
            background: rgba(11, 14, 17, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 212, 170, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            padding: 15px 20px;
            transition: all 0.3s ease;
        }

        .light-theme .header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 212, 170, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header-main {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 250px;
        }

        .app-title {
            font-size: 1.3rem;
            background: linear-gradient(135deg, #00D4AA, #00ff88, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
            cursor: pointer;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
       
       .ai-status {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
            font-size: 0.8rem;
            animation: aiPulse 2s infinite;
            position: relative;
        }

        .ai-status::before {
            content: '‚óè';
            position: absolute;
            left: -15px;
            color: #00D4AA;
            animation: aiDot 1.5s infinite;
        }

        @keyframes aiPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        @keyframes aiDot {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .header-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }

        .current-price {
            font-size: 1.8rem;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
            transition: all 0.3s ease;
        }

        .current-price:hover {
            transform: scale(1.05);
            text-shadow: 0 0 30px rgba(0, 212, 170, 0.5);
        }

        .light-theme .current-price {
            color: #1e293b;
            text-shadow: 0 0 20px rgba(0, 212, 170, 0.2);
        }
       
       .current-change {
            font-size: 1rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            justify-content: flex-end;
            min-width: 250px;
        }

        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #00D4AA, #00ff88);
            border: none;
            border-radius: 12px;
            color: #0B0E11;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 212, 170, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.4);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
       
       .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .status-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            filter: brightness(1.2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .status-indicator:hover::before {
            opacity: 1;
        }

        .connected {
            background: rgba(0, 212, 170, 0.2);
            border: 1px solid #00D4AA;
            color: #00D4AA;
            box-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
        }

        .disconnected {
            background: rgba(248, 73, 96, 0.2);
            border: 1px solid #F84960;
            color: #F84960;
            box-shadow: 0 0 20px rgba(248, 73, 96, 0.3);
        }

        .connecting {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #FFC107;
            color: #FFC107;
            animation: connectingPulse 1.5s infinite;
        }

        @keyframes connectingPulse {
            0%, 100% { 
                opacity: 0.8; 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.02);
                box-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
            }
        }
       .main-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .panel {
            background: rgba(26, 26, 46, 0.9);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(0, 212, 170, 0.15);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .light-theme .panel {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 212, 170, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00D4AA, #00ff88, #4ECDC4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 212, 170, 0.2);
            border-color: rgba(0, 212, 170, 0.3);
        }

        .panel:hover::before {
            opacity: 1;
        }

        .panel h3 {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: #00D4AA;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }
        
        .signal-box {
            background: rgba(0, 212, 170, 0.1);
            border: 2px solid #00D4AA;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .signal-box::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #00D4AA, #00ff88, #4ECDC4, #00D4AA);
            z-index: -1;
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .signal-box:hover::before {
            opacity: 0.7;
            animation: borderRotate 3s linear infinite;
        }

        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .signal-box.sell {
            background: rgba(248, 73, 96, 0.1);
            border-color: #F84960;
        }

        .signal-box.sell::before {
            background: linear-gradient(45deg, #F84960, #FF6B6B, #FF8A80, #F84960);
        }

        .signal-box.buy {
            background: rgba(0, 212, 170, 0.1);
            border-color: #00D4AA;
        }

        .confidence-meter {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            height: 10px;
            margin: 12px 0;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B6B, #FFC107, #00D4AA);
            border-radius: 10px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: confidenceShine 2s infinite;
        }

        @keyframes confidenceShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .debug-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.75rem;
            max-height: 220px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #00D4AA #333;
            position: relative;
        }

        .light-theme .debug-panel {
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid #e2e8f0;
            color: #334155;
        }

        .debug-panel::-webkit-scrollbar {
            width: 6px;
        }

        .debug-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .debug-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #00D4AA, #4ECDC4);
            border-radius: 3px;
        }

        .debug-log {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 6px;
            word-wrap: break-word;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .debug-log:hover {
            transform: translateX(3px);
            background: rgba(255, 255, 255, 0.05);
        }

        .debug-error {
            background: rgba(248, 73, 96, 0.15);
            color: #FF8A80;
            border-left-color: #F84960;
        }

        .debug-success {
            background: rgba(0, 212, 170, 0.15);
            color: #4ECDC4;
            border-left-color: #00D4AA;
        }

        .debug-info {
            background: rgba(70, 130, 180, 0.15);
            color: #87CEEB;
            border-left-color: #4682B4;
        }

        .debug-warning {
            background: rgba(255, 193, 7, 0.15);
            color: #FFD54F;
            border-left-color: #FFC107;
        }
        
        .toast {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            font-size: 0.9rem;
            font-weight: 500;
            animation: toastSlideIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: none;
            max-width: 350px;
            word-wrap: break-word;
            border-left: 4px solid #00D4AA;
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.9), rgba(76, 205, 196, 0.9));
            border-left-color: #00D4AA;
        }

        .toast.error {
            background: linear-gradient(135deg, rgba(248, 73, 96, 0.9), rgba(255, 107, 107, 0.9));
            border-left-color: #F84960;
        }

        .toast.warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.9), rgba(255, 235, 59, 0.9));
            color: #1a1a1a;
            border-left-color: #FFC107;
        }

        @keyframes toastSlideIn {
            from { 
                transform: translateX(100px) scale(0.8); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0) scale(1); 
                opacity: 1; 
            }
        }

        .theme-toggle {
            padding: 10px 18px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
            user-select: none;
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        input[type="text"] {
            padding: 12px 16px;
            border-radius: 10px;
            border: 2px solid rgba(0, 212, 170, 0.3);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 0.9rem;
            width: 160px;
            transition: all 0.3s ease;
            outline: none;
            backdrop-filter: blur(10px);
        }

        .light-theme input[type="text"] {
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            border-color: rgba(0, 212, 170, 0.4);
        }

        input[type="text"]:focus {
            border-color: #00D4AA;
            box-shadow: 0 0 20px rgba(0, 212, 170, 0.3);
            transform: scale(1.02);
            background: rgba(255, 255, 255, 0.1);
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .light-theme input[type="text"]::placeholder {
            color: rgba(30, 41, 59, 0.6);
        }

        /* Strategy Badge */
        .strategy-badge {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, #4ECDC4, #45B7D1);
            color: #fff;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
            animation: badgePulse 2s infinite;
        }

        @keyframes badgePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* AI Learning Indicator */
        .ai-learning-dot {
            width: 8px;
            height: 8px;
            background: #00D4AA;
            border-radius: 50%;
            animation: aiDotPulse 1.5s infinite;
            margin-left: 8px;
        }

        @keyframes aiDotPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }
        
        @media (max-width: 768px) {
            .header-main {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .header-left, .header-center, .header-right {
                width: 100%;
                justify-content: center;
                min-width: unset;
            }

            .header-right {
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .main-container {
                grid-template-columns: 1fr;
                padding: 15px;
                gap: 15px;
            }

            .panel {
                padding: 16px;
            }

            .btn, input[type="text"] {
                font-size: 1rem;
                padding: 14px;
                width: 100%;
                margin: 6px 0;
            }

            .current-price {
                font-size: 1.5rem;
            }

            .app-title {
                font-size: 1.1rem;
            }

            .toast {
                bottom: 15px;
                right: 15px;
                left: 15px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 10px;
                gap: 10px;
            }

            .panel {
                padding: 12px;
            }

            .current-price {
                font-size: 1.3rem;
            }
        }

        html {
            scroll-behavior: smooth;
        }

        /* Performance optimizations */
        .panel, .btn, .signal-box {
            will-change: transform;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-main">
            <div class="header-left">
                <div class="status-indicator disconnected" id="connectionStatus">üî¥ Baƒülantƒ± Yok</div>
                <span class="app-title">ü§ñ AI OrderBook Sinyal Botu v4.0</span>
                <div class="ai-status" id="aiStatus">üß† AI Bekliyor...</div>
                <div class="ai-learning-dot"></div>
            </div>
            
            <div class="header-center">
                <div class="current-price" id="headerPrice">$0.00000000</div>
                <div class="current-change" id="headerChange">üìä +0.00%</div>
            </div>
            
            <div class="header-right">
                <input id="manualSymbol" type="text" placeholder="Coin sembol√º (BTC, PEPE...)">
                <button class="btn" id="connectBtn" onclick="toggleConnection()">üîå Baƒülan</button>
                <div class="theme-toggle" onclick="toggleTheme()">üåô Tema</div>
            </div>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Debug Panel -->
        <div class="panel">
            <h3>üîß Debug Panel</h3>
            <div class="debug-panel" id="debugPanel">
                <div class="debug-log debug-info">üöÄ AI OrderBook Sinyal Botu v4.0 ba≈ülatƒ±ldƒ±</div>
                <div class="debug-log debug-info">üí° Coin sembol√º girin ve Baƒülan tu≈üuna basƒ±n</div>
                <div class="debug-log debug-success">üß† AI √∂ƒürenme sistemi aktif</div>
            </div>
            <div style="margin-top: 12px; font-size: 0.8rem; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <div>üì° WebSocket: <span id="wsStatus">Kapalƒ±</span></div>
                <div>üîó Exchange: <span id="exchangeStatus">MEXC</span></div>
                <div>üìä Veri: <span id="dataStatus">Bekliyor</span></div>
                <div>‚è±Ô∏è Son Update: <span id="lastUpdate">-</span></div>
                <div>üß† AI Durumu: <span id="aiLearningStatus">Hazƒ±r</span></div>
                <div>üíæ Hafƒ±za: <span id="memoryStatus">Aktif</span></div>
            </div>
        </div>

        <!-- AI Dashboard -->
        <div class="panel">
            <h3>üß† AI Kontrol Merkezi <div class="ai-learning-dot"></div></h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;">
                <div style="text-align: center; padding: 12px; background: rgba(0,212,170,0.1); border-radius: 10px;">
                    <div style="font-size: 1.8rem; font-weight: 700; color: #00D4AA;" id="aiScore">0</div>
                    <div style="font-size: 0.8rem; color: #888;">AI Performans</div>
                </div>
                <div style="text-align: center; padding: 12px; background: rgba(76,205,196,0.1); border-radius: 10px;">
                    <div style="font-size: 1.8rem; font-weight: 700; color: #4ECDC4;" id="learningProgress">0%</div>
                    <div style="font-size: 0.8rem; color: #888;">√ñƒürenme ƒ∞lerlemesi</div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 6px;">Aktif Stratejiler:</div>
                <div id="activeStrategies" style="display: flex; gap: 6px; flex-wrap: wrap;">
                    <span class="strategy-badge">Whale Movement</span>
                    <span class="strategy-badge">OrderBook Imbalance</span>
                    <span class="strategy-badge">Volume Spike</span>
                    <span class="strategy-badge">Support/Resistance</span>
                </div>
            </div>

            <div style="margin-top: 12px; font-size: 0.75rem; color: #888;">
                <div>üìä ƒ∞≈ülenen Veri: <span id="processedData">0</span></div>
                <div>üéØ √ñƒürenme Hƒ±zƒ±: <span id="learningRate">Orta</span></div>
                <div>‚ö° Model Versiyonu: <span id="modelVersion">v4.0</span></div>
            </div>
        </div>
        
        <!-- Aktif Sinyal Paneli -->
        <div class="panel">
            <h3>üéØ Aktif Sinyal</h3>
            
            <div id="currentSignal" class="signal-box">
                <div style="font-weight: 700; margin-bottom: 8px;">‚è≥ Sinyal Bekleniyor...</div>
                <div style="font-size: 0.8rem; color: #888;">AI OrderBook analizi yapƒ±yor</div>
            </div>

            <div class="confidence-meter">
                <div class="confidence-fill" id="confidenceBar" style="width: 0%"></div>
            </div>
            <div style="font-size: 0.75rem; color: #888; text-align: center; margin-bottom: 12px;">
                G√ºven Seviyesi: <span id="confidencePercent">0%</span>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 12px 0;">
                <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.7rem; color: #888;">Giri≈ü Fiyatƒ±</div>
                    <div style="font-weight: 600; color: #fff;" id="entryPrice">-</div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.7rem; color: #888;">Strateji</div>
                    <div style="font-weight: 600; color: #4ECDC4;" id="currentStrategy">-</div>
                </div>
                <div style="background: rgba(0,212,170,0.1); padding: 8px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.7rem; color: #888;">Take Profit</div>
                    <div style="font-weight: 600; color: #00D4AA;" id="tpPrice">-</div>
                </div>
                <div style="background: rgba(248,73,96,0.1); padding: 8px; border-radius: 8px; text-align: center;">
                    <div style="font-size: 0.7rem; color: #888;">Stop Loss</div>
                    <div style="font-weight: 600; color: #F84960;" id="slPrice">-</div>
                </div>
            </div>

            <div style="margin-top: 12px; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                <div style="font-size: 0.75rem; color: #888;">Sinyal Detaylarƒ±:</div>
                <div style="font-size: 0.7rem; margin-top: 5px;">
                    <div>Sinyal S√ºresi: <span id="signalDuration">-</span></div>
                    <div>OrderBook G√º√ßl√ºƒü√º: <span id="orderbookStrength">-</span></div>
                    <div>AI √ñneri: <span id="aiRecommendation">Bekliyor</span></div>
                </div>
            </div>
        </div>
        
        <!-- OrderBook Analiz Paneli -->
        <div class="panel">
            <h3>üìã OrderBook Analizi</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 12px 0;">
                <div style="text-align: center; padding: 10px; background: rgba(0,212,170,0.1); border-radius: 8px;">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #00D4AA;" id="bidPressure">0%</div>
                    <div style="font-size: 0.7rem; color: #888;">Alƒ±cƒ± Baskƒ±sƒ±</div>
                </div>
                <div style="text-align: center; padding: 10px; background: rgba(248,73,96,0.1); border-radius: 8px;">
                    <div style="font-size: 1.3rem; font-weight: 700; color: #F84960;" id="askPressure">0%</div>
                    <div style="font-size: 0.7rem; color: #888;">Satƒ±cƒ± Baskƒ±sƒ±</div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">Market Dengesizlik</div>
                <div style="font-size: 1.2rem; font-weight: 700;" id="orderbookImbalance">0%</div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">Whale Activity</div>
                <div id="whaleActivity" style="padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="font-size: 0.8rem; color: #FFC107;" id="whaleStatus">Normal Activity</div>
                    <div style="font-size: 0.7rem; color: #888; margin-top: 3px;" id="whaleDetails">B√ºy√ºk emir tespit edilmedi</div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 5px;">Support/Resistance Levels</div>
                <div style="font-size: 0.7rem;">
                    <div>Yakƒ±n Destek: <span id="nearSupport" style="color: #00D4AA;">-</span></div>
                    <div>Yakƒ±n Diren√ß: <span id="nearResistance" style="color: #F84960;">-</span></div>
                    <div>Break Probability: <span id="breakProbability" style="color: #4ECDC4;">-</span></div>
                </div>
            </div>

            <div style="margin-top: 12px; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 8px;">
                <div style="font-size: 0.75rem; color: #888;">OrderBook Quality:</div>
                <div style="font-size: 0.7rem; margin-top: 5px;" id="orderbookQuality">
                    Spread: <span id="currentSpread">-</span> | Depth: <span id="marketDepth">-</span>
                </div>
            </div>
        </div>
        
        <!-- Strateji Performans Paneli -->
        <div class="panel">
            <h3>üìä Strateji Performanslarƒ±</h3>
            
            <div id="strategyStats" style="margin: 12px 0;">
                <div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; font-weight: 600;">üêã Whale Movement</span>
                        <span id="whaleStrategy" style="color: #00D4AA; font-weight: 700;">0% (0/0)</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #888; margin-top: 3px;">
                        Avg Profit: <span id="whaleAvgProfit">0%</span> | Avg Time: <span id="whaleAvgTime">-</span>
                    </div>
                </div>

                <div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; font-weight: 600;">‚öñÔ∏è OrderBook Imbalance</span>
                        <span id="imbalanceStrategy" style="color: #4ECDC4; font-weight: 700;">0% (0/0)</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #888; margin-top: 3px;">
                        Avg Profit: <span id="imbalanceAvgProfit">0%</span> | Avg Time: <span id="imbalanceAvgTime">-</span>
                    </div>
                </div>

                <div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; font-weight: 600;">üìà Volume Spike</span>
                        <span id="volumeStrategy" style="color: #FFC107; font-weight: 700;">0% (0/0)</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #888; margin-top: 3px;">
                        Avg Profit: <span id="volumeAvgProfit">0%</span> | Avg Time: <span id="volumeAvgTime">-</span>
                    </div>
                </div>

                <div style="margin-bottom: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.8rem; font-weight: 600;">üéØ Support/Resistance</span>
                        <span id="srStrategy" style="color: #FF6B6B; font-weight: 700;">0% (0/0)</span>
                    </div>
                    <div style="font-size: 0.7rem; color: #888; margin-top: 3px;">
                        Avg Profit: <span id="srAvgProfit">0%</span> | Avg Time: <span id="srAvgTime">-</span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 12px; padding: 8px; background: rgba(0,212,170,0.1); border-radius: 8px;">
                <div style="font-size: 0.8rem; font-weight: 600; color: #00D4AA; margin-bottom: 5px;">En ƒ∞yi Strateji</div>
                <div style="font-size: 0.9rem; font-weight: 700;" id="bestStrategy">Veri toplanƒ±yor...</div>
                <div style="font-size: 0.7rem; color: #888; margin-top: 3px;" id="bestStrategyDetails">-</div>
            </div>
        </div>
        
        <!-- Sinyal Ge√ßmi≈üi Paneli -->
        <div class="panel">
            <h3>üìà Sinyal Ge√ßmi≈üi & ƒ∞statistikler</h3>
            
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 12px 0;">
                <div style="text-align: center; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: #fff;" id="totalSignals">0</div>
                    <div style="font-size: 0.7rem; color: #888;">Toplam</div>
                </div>
                <div style="text-align: center; padding: 8px; background: rgba(0,212,170,0.1); border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: #00D4AA;" id="successfulSignals">0</div>
                    <div style="font-size: 0.7rem; color: #888;">Ba≈üarƒ±lƒ±</div>
                </div>
                <div style="text-align: center; padding: 8px; background: rgba(76,205,196,0.1); border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: #4ECDC4;" id="successRate">0%</div>
                    <div style="font-size: 0.7rem; color: #888;">Ba≈üarƒ±</div>
                </div>
                <div style="text-align: center; padding: 8px; background: rgba(255,193,7,0.1); border-radius: 8px;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: #FFC107;" id="avgProfit">0%</div>
                    <div style="font-size: 0.7rem; color: #888;">Avg Kar</div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 6px;">Son 10 Sinyal:</div>
                <div id="signalHistory" style="max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 8px;">
                    <div style="text-align: center; color: #888; font-size: 0.8rem; padding: 20px;">
                        Sinyal ge√ßmi≈üi burada g√∂r√ºnecek
                    </div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 6px;">G√ºnl√ºk ƒ∞statistikler:</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <div style="padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 0.7rem;">
                        Bug√ºn: <span id="todaySignals" style="color: #00D4AA; font-weight: 600;">0</span>
                    </div>
                    <div style="padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px; font-size: 0.7rem;">
                        Bu Saat: <span id="hourlySignals" style="color: #4ECDC4; font-weight: 600;">0</span>
                    </div>
                </div>
            </div>

            <div style="margin-top: 12px;">
                <button class="btn" style="padding: 8px 16px; font-size: 0.8rem;" onclick="clearHistory()">üóëÔ∏è Ge√ßmi≈üi Temizle</button>
                <button class="btn" style="padding: 8px 16px; font-size: 0.8rem; margin-left: 8px;" onclick="exportHistory()">üì§ Dƒ±≈üa Aktar</button>
            </div>
        </div>
        
        <!-- Bot Ayarlarƒ± Paneli -->
        <div class="panel">
            <h3>‚öôÔ∏è Bot Ayarlarƒ± & AI Konfig√ºrasyonu</h3>
            
            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">Sinyal Parametreleri:</div>
                
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #ccc;">Volume E≈üiƒüi: </label>
                    <input type="range" id="volumeThreshold" min="1.2" max="5.0" step="0.1" value="2.0" style="width: 120px; margin: 0 8px;">
                    <span id="volumeThresholdValue" style="color: #00D4AA; font-weight: 600;">2.0x</span>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #ccc;">Take Profit: </label>
                    <input type="range" id="takeProfitPercent" min="0.3" max="3.0" step="0.1" value="0.8" style="width: 120px; margin: 0 8px;">
                    <span id="takeProfitValue" style="color: #00D4AA; font-weight: 600;">0.8%</span>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #ccc;">Stop Loss: </label>
                    <input type="range" id="stopLossPercent" min="0.2" max="2.0" step="0.1" value="0.5" style="width: 120px; margin: 0 8px;">
                    <span id="stopLossValue" style="color: #F84960; font-weight: 600;">0.5%</span>
                </div>

                <div style="margin-bottom: 12px;">
                    <label style="font-size: 0.75rem; color: #ccc;">Minimum G√ºven: </label>
                    <input type="range" id="minConfidence" min="50" max="95" step="5" value="70" style="width: 120px; margin: 0 8px;">
                    <span id="minConfidenceValue" style="color: #4ECDC4; font-weight: 600;">70%</span>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <div style="font-size: 0.8rem; color: #888; margin-bottom: 8px;">AI √ñƒürenme Ayarlarƒ±:</div>
                
                <div style="margin-bottom: 10px;">
                    <label style="font-size: 0.75rem; color: #ccc;">√ñƒürenme Hƒ±zƒ±: </label>
                    <select id="learningSpeed" style="background: rgba(255,255,255,0.1); border: 1px solid #00D4AA; border-radius: 6px; padding: 4px 8px; color: #fff; margin-left: 8px;">
                        <option value="slow">Yava≈ü</option>
                        <option value="medium" selected>Orta</option>
                        <option value="fast">Hƒ±zlƒ±</option>
                    </select>
                </div>

                <div style="margin-bottom: 10px;">
                    <label style="font-size: 0.75rem; color: #ccc;">
                        <input type="checkbox" id="autoOptimization" checked style="margin-right: 6px;">
                        Otomatik Optimizasyon
                    </label>
                </div>

                <div style="margin-bottom: 10px;">
                    <label style="font-size: 0.75rem; color: #ccc;">
                        <input type="checkbox" id="adaptiveThresholds" checked style="margin-right: 6px;">
                        Adaptif E≈üikler
                    </label>
                </div>
            </div>

            <div style="margin-top: 15px;">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button class="btn" style="padding: 8px 16px; font-size: 0.8rem;" onclick="saveSettings()">üíæ Kaydet</button>
                    <button class="btn" style="padding: 8px 16px; font-size: 0.8rem;" onclick="resetSettings()">üîÑ Varsayƒ±lan</button>
                    <button class="btn" style="padding: 8px 16px; font-size: 0.8rem;" onclick="resetAI()">üß† AI Sƒ±fƒ±rla</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    
    <script>
        // Global deƒüi≈ükenler
let ws = null;
let isConnected = false;
let currentSymbol = 'BTC_USDT';
let lastPrice = 0;
let priceHistory = [];
let volumeHistory = [];
let orderBookData = { bids: [], asks: [] };
let activeSignal = null;
let signalHistory = [];
let reconnectAttempts = 0;
let maxReconnectAttempts = 3;
let pingInterval = null;
let lastSignalTime = 0;

// Bot ayarlarƒ±
let botSettings = {
    volumeThreshold: 2.0,
    takeProfitPercent: 0.8,
    stopLossPercent: 0.5,
    minConfidence: 70,
    signalCooldown: 30000,
    learningSpeed: 'medium',
    autoOptimization: true,
    adaptiveThresholds: true
};

// AI ve Strateji deƒüi≈ükenleri
let aiLearningData = {
    totalProcessed: 0,
    learningProgress: 0,
    performanceScore: 0,
    strategies: {
        whale: { total: 0, success: 0, profits: [], times: [] },
        imbalance: { total: 0, success: 0, profits: [], times: [] },
        volume: { total: 0, success: 0, profits: [], times: [] },
        sr: { total: 0, success: 0, profits: [], times: [] }
    }
};

let supportResistanceLevels = {
    support: [],
    resistance: [],
    lastCalculated: 0
};

// DOM elementlerini g√ºvenli ≈üekilde g√ºncelleme fonksiyonu
function safeUpdateElement(id, value, property = 'textContent') {
    const element = document.getElementById(id);
    if (element) {
        element[property] = value;
        return true;
    } else {
        console.warn(`Element bulunamadƒ±: ${id}`);
        return false;
    }
}

// Coin sembol√º doƒürulama - MEXC formatƒ±
function validateSymbol(symbol) {
    const coin = symbol.trim().toUpperCase();
    if (/^[A-Z]{2,10}$/.test(coin)) {
        return { 
            valid: true, 
            coin: coin + '_USDT', 
            message: `üîç ${coin}_USDT MEXC analizi ba≈ülatƒ±lƒ±yor...` 
        };
    }
    return { 
        valid: false, 
        coin: null, 
        message: `‚ùå Ge√ßersiz format: 2-10 harf kullanƒ±n` 
    };
}

// Debug log fonksiyonu
function debugLog(message, type = 'info') {
    const el = document.getElementById('debugPanel');
    if (!el) return;
    
    const logEntry = document.createElement('div');
    logEntry.className = `debug-log debug-${type}`;
    logEntry.innerText = `[${new Date().toLocaleTimeString('tr-TR')}] ${message}`;
    el.insertBefore(logEntry, el.firstChild);
    if (el.children.length > 100) el.removeChild(el.lastChild);
}

// Toast bildirimi
function showToast(message, type = 'info') {
    const toast = document.getElementById('toast');
    if (!toast) return;
    
    toast.textContent = message;
    toast.className = `toast show ${type}`;
    setTimeout(() => toast.classList.remove('show'), 3000);
}

// Hassas fiyat formatƒ± (d√º≈ü√ºk deƒüerli coinler i√ßin)
function formatPrice(price) {
    if (price === 0) return '$0.00000000';
    if (price >= 1) return `$${price.toFixed(4)}`;
    if (price >= 0.01) return `$${price.toFixed(6)}`;
    return `$${price.toFixed(8)}`;
}

// Fiyat g√∂sterimi g√ºncelle (D√úZELTƒ∞LMƒ∞≈û)
function updatePriceDisplay(price, change = 0) {
    safeUpdateElement('headerPrice', formatPrice(price));
    
    const changeIcon = change >= 0 ? 'üìà' : 'üìâ';
    const changeText = `${changeIcon} ${change >= 0 ? '+' : ''}${change.toFixed(3)}%`;
    
    const changeEl = document.getElementById('headerChange');
    if (changeEl) {
        changeEl.textContent = changeText;
        changeEl.style.color = change >= 0 ? '#00D4AA' : '#F84960';
        changeEl.style.background = change >= 0 ? 'rgba(0,212,170,0.1)' : 'rgba(248,73,96,0.1)';
    }
    
    lastPrice = price;
}

// MEXC WebSocket baƒülantƒ±sƒ±
function connect() {
    try {
        const coinInput = document.getElementById('manualSymbol').value.trim();
        if (!coinInput) {
            showToast('‚ùå Coin sembol√º girin', 'error');
            return;
        }

        const validation = validateSymbol(coinInput);
        if (!validation.valid) {
            showToast(validation.message, 'error');
            return;
        }

        currentSymbol = validation.coin;
        debugLog(`üîó ${currentSymbol} i√ßin MEXC baƒülantƒ±sƒ± kuruluyor...`, 'info');

        const wsUrl = 'wss://futures.mexc.com/edge';
        
        const connectBtn = document.getElementById('connectBtn');
        if (connectBtn) {
            connectBtn.innerHTML = 'üîó Baƒülanƒ±yor...';
            connectBtn.disabled = true;
        }
        
        const connectionStatus = document.getElementById('connectionStatus');
        if (connectionStatus) {
            connectionStatus.className = 'status-indicator connecting';
            connectionStatus.innerHTML = 'üü° Baƒülanƒ±yor...';
        }

        ws = new WebSocket(wsUrl);

        ws.onopen = () => {
            isConnected = true;
            reconnectAttempts = 0;
            updateConnectionStatus(true);
            debugLog('‚úÖ MEXC WebSocket baƒülandƒ±', 'success');
            showToast('‚úÖ MEXC baƒülantƒ±sƒ± ba≈üarƒ±lƒ±', 'success');
            subscribeToPair(currentSymbol);
            startPing();
            startAILearning();
        };

        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                handleMEXCData(data);
            } catch (error) {
                debugLog(`‚ùå Veri i≈üleme hatasƒ±: ${error.message}`, 'error');
            }
        };

        ws.onclose = () => {
            isConnected = false;
            updateConnectionStatus(false);
            debugLog('‚ö†Ô∏è WebSocket baƒülantƒ±sƒ± kapandƒ±', 'warning');
            stopPing();
            attemptReconnect();
        };

        ws.onerror = (error) => {
            debugLog(`‚ùå WebSocket hatasƒ±`, 'error');
            showToast('‚ùå Baƒülantƒ± hatasƒ±', 'error');
        };

    } catch (error) {
        debugLog(`‚ùå Baƒülantƒ± ba≈ülatma hatasƒ±: ${error.message}`, 'error');
        resetConnectionUI();
    }
}

function subscribeToPair(symbol) {
    if (ws && ws.readyState === WebSocket.OPEN) {
        const subscriptions = [
            { method: 'sub.deal', param: { symbol }, id: 'deal_' + symbol },
            { method: 'sub.depth', param: { symbol, depth: 20 }, id: 'depth_' + symbol },
            { method: 'sub.ticker', param: { symbol }, id: 'ticker_' + symbol }
        ];
        subscriptions.forEach(sub => {
            ws.send(JSON.stringify(sub));
            debugLog(`üì° MEXC abonelik: ${sub.method}`, 'info');
        });
    }
}

function disconnect() {
    try {
        if (ws) {
            ws.close();
            ws = null;
        }
        isConnected = false;
        updateConnectionStatus(false);
        resetConnectionUI();
        debugLog("üî¥ Baƒülantƒ± kapatƒ±ldƒ±", 'info');
        stopPing();
        reconnectAttempts = 0;
    } catch (error) {
        debugLog(`‚ùå Baƒülantƒ± kapatma hatasƒ±: ${error.message}`, 'error');
    }
}

// Baƒülantƒ± durumu g√ºncelleme (D√úZELTƒ∞LMƒ∞≈û)
function updateConnectionStatus(connected) {
    const status = document.getElementById('connectionStatus');
    const connectBtn = document.getElementById('connectBtn');
    
    if (connected) {
        if (status) {
            status.className = 'status-indicator connected';
            status.innerHTML = 'üü¢ MEXC Baƒülƒ±';
        }
        safeUpdateElement('aiStatus', 'üß† AI Analiz Yapƒ±yor');
        safeUpdateElement('wsStatus', 'A√ßƒ±k');
        safeUpdateElement('dataStatus', 'Aktif');
        
        if (connectBtn) {
            connectBtn.innerHTML = 'üîå Baƒülantƒ±yƒ± Kes';
            connectBtn.disabled = false;
        }
        
        const aiLearningStatus = document.getElementById('aiLearningStatus');
        if (aiLearningStatus) {
            aiLearningStatus.textContent = '√ñƒüreniyor';
            aiLearningStatus.style.color = '#00D4AA';
        }
    } else {
        if (status) {
            status.className = 'status-indicator disconnected';
            status.innerHTML = 'üî¥ Baƒülantƒ± Yok';
        }
        safeUpdateElement('aiStatus', 'üß† AI Bekliyor...');
        
        if (connectBtn) {
            connectBtn.innerHTML = 'üîå Baƒülan';
            connectBtn.disabled = false;
        }
        
        const aiLearningStatus = document.getElementById('aiLearningStatus');
        if (aiLearningStatus) {
            aiLearningStatus.textContent = 'Hazƒ±r';
            aiLearningStatus.style.color = '#888';
        }
    }
}

// UI sƒ±fƒ±rlama (D√úZELTƒ∞LMƒ∞≈û)
function resetConnectionUI() {
    const connectBtn = document.getElementById('connectBtn');
    if (connectBtn) {
        connectBtn.innerHTML = 'üîå Baƒülan';
        connectBtn.disabled = false;
    }
    safeUpdateElement('wsStatus', 'Kapalƒ±');
    safeUpdateElement('dataStatus', 'Bekliyor');
    safeUpdateElement('lastUpdate', '-');
}

function attemptReconnect() {
    if (reconnectAttempts < maxReconnectAttempts) {
        reconnectAttempts++;
        debugLog(`üîÑ Yeniden baƒülanma ${reconnectAttempts}/${maxReconnectAttempts}`, 'warning');
        setTimeout(connect, 5000 * reconnectAttempts);
    } else {
        debugLog('‚ùå Maksimum yeniden baƒülanma a≈üƒ±ldƒ±', 'error');
        showToast('‚ùå Otomatik yeniden baƒülanma durdu', 'error');
    }
}

function toggleConnection() {
    if (isConnected) {
        disconnect();
    } else {
        connect();
    }
}

function startPing() {
    pingInterval = setInterval(() => {
        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify({ method: 'ping' }));
        }
    }, 30000);
}

function stopPing() {
    if (pingInterval) {
        clearInterval(pingInterval);
        pingInterval = null;
    }
}

// MEXC veri i≈üleme (D√úZELTƒ∞LMƒ∞≈û)
function handleMEXCData(data) {
    try {
        if (!data.channel || !data.data) return;

        if (data.channel === 'push.deal') {
            const deal = data.data;
            const price = parseFloat(deal.p);
            const volume = parseFloat(deal.v);
            
            updatePriceDisplay(price, 0);
            processPriceData(price, volume);
            
        } else if (data.channel === 'push.depth') {
            orderBookData = {
                bids: data.data.bids.map(([price, volume]) => [parseFloat(price), parseFloat(volume)]),
                asks: data.data.asks.map(([price, volume]) => [parseFloat(price), parseFloat(volume)])
            };
            processOrderBookData();
            
        } else if (data.channel === 'push.ticker') {
            const ticker = data.data;
            const price = parseFloat(ticker.lastPrice);
            const change = parseFloat(ticker.priceChangePercent || 0);
            updatePriceDisplay(price, change);
        }
        
        // Son g√ºncelleme zamanƒ±nƒ± g√ºvenli ≈üekilde g√ºncelle
        safeUpdateElement('lastUpdate', new Date().toLocaleTimeString('tr-TR'));
        
    } catch (error) {
        debugLog(`‚ùå MEXC veri i≈üleme hatasƒ±: ${error.message}`, 'error');
    }
}

function processPriceData(price, volume) {
    // Fiyat ve volume ge√ßmi≈üi g√ºncelle
    priceHistory.push(price);
    volumeHistory.push(volume);
    
    if (priceHistory.length > 200) priceHistory.shift();
    if (volumeHistory.length > 50) volumeHistory.shift();
    
    // AI √∂ƒürenme verilerini g√ºncelle
    aiLearningData.totalProcessed++;
    updateAIProgress();
    
    // Support/Resistance seviyelerini g√ºncelle
    if (Date.now() - supportResistanceLevels.lastCalculated > 60000) {
        calculateSupportResistance();
    }
    
    // Aktif sinyal kontrol√º
    if (activeSignal) {
        checkActiveSignal(price);
    }
    
    // Yeni sinyal kontrol√º
    if (Date.now() - lastSignalTime > botSettings.signalCooldown) {
        analyzeForSignals(price, volume);
    }
}

function processOrderBookData() {
    if (!orderBookData.bids.length || !orderBookData.asks.length) return;
    
    // OrderBook analizi
    const analysis = analyzeOrderBook();
    updateOrderBookUI(analysis);
    
    // Whale activity kontrol√º
    detectWhaleActivity(analysis);
}

function analyzeOrderBook() {
    const topBids = orderBookData.bids.slice(0, 10);
    const topAsks = orderBookData.asks.slice(0, 10);
    
    const bidVolume = topBids.reduce((sum, [_, vol]) => sum + vol, 0);
    const askVolume = topAsks.reduce((sum, [_, vol]) => sum + vol, 0);
    const totalVolume = bidVolume + askVolume;
    
    const imbalance = totalVolume > 0 ? ((bidVolume - askVolume) / totalVolume * 100) : 0;
    const bidPressure = totalVolume > 0 ? (bidVolume / totalVolume * 100) : 50;
    const askPressure = 100 - bidPressure;
    
    // Spread hesapla
    const spread = orderBookData.asks[0] ? orderBookData.asks[0][0] - orderBookData.bids[0][0] : 0;
    const spreadPercent = lastPrice > 0 ? (spread / lastPrice * 100) : 0;
    
    return {
        imbalance,
        bidPressure,
        askPressure,
        bidVolume,
        askVolume,
        spread,
        spreadPercent,
        topBids,
        topAsks
    };
}

function updateOrderBookUI(analysis) {
    // Bid/Ask baskƒ±sƒ±
    safeUpdateElement('bidPressure', `${analysis.bidPressure.toFixed(1)}%`);
    safeUpdateElement('askPressure', `${analysis.askPressure.toFixed(1)}%`);
    
    // Market dengesizlik
    const imbalanceEl = document.getElementById('orderbookImbalance');
    if (imbalanceEl) {
        imbalanceEl.textContent = `${analysis.imbalance.toFixed(1)}%`;
        imbalanceEl.style.color = analysis.imbalance > 0 ? '#00D4AA' : '#F84960';
    }
    
    // Spread bilgisi
    safeUpdateElement('currentSpread', formatPrice(analysis.spread));
    safeUpdateElement('marketDepth', `${(analysis.bidVolume + analysis.askVolume).toFixed(2)}`);
    
    // OrderBook kalitesi
    let quality = 'ƒ∞yi';
    if (analysis.spreadPercent > 0.1) quality = 'Zayƒ±f';
    else if (analysis.spreadPercent > 0.05) quality = 'Orta';
    
    const qualityEl = document.getElementById('orderbookQuality');
    if (qualityEl) {
        qualityEl.innerHTML = 
            `Spread: ${formatPrice(analysis.spread)} (${analysis.spreadPercent.toFixed(3)}%) | Depth: ${quality}`;
    }
}

function detectWhaleActivity(analysis) {
    const whaleThreshold = Math.max(analysis.bidVolume, analysis.askVolume) * 3;
    let whaleDetected = false;
    let whaleType = '';
    let whaleSize = 0;
    
    // B√ºy√ºk bid emirleri kontrol et
    analysis.topBids.forEach(([price, volume]) => {
        if (volume > whaleThreshold) {
            whaleDetected = true;
            whaleType = 'BUY';
            whaleSize = Math.max(whaleSize, volume);
        }
    });
    
    // B√ºy√ºk ask emirleri kontrol et
    analysis.topAsks.forEach(([price, volume]) => {
        if (volume > whaleThreshold) {
            whaleDetected = true;
            whaleType = whaleType ? 'MIXED' : 'SELL';
            whaleSize = Math.max(whaleSize, volume);
        }
    });
    
    // Whale activity UI g√ºncelle
    const whaleStatus = document.getElementById('whaleStatus');
    const whaleDetails = document.getElementById('whaleDetails');
    
    if (whaleDetected) {
        safeUpdateElement('whaleStatus', `üêã ${whaleType} Whale Detected`);
        if (whaleStatus) {
            whaleStatus.style.color = whaleType === 'BUY' ? '#00D4AA' : whaleType === 'SELL' ? '#F84960' : '#FFC107';
        }
        safeUpdateElement('whaleDetails', `B√ºy√ºk emir: ${whaleSize.toFixed(2)} | ${formatPrice(lastPrice)}`);
        
        // Whale sinyali i√ßin not et
        if (whaleSize > whaleThreshold * 2) {
            debugLog(`üêã B√ºy√ºk ${whaleType} whale activity: ${whaleSize.toFixed(2)}`, 'warning');
        }
    } else {
        safeUpdateElement('whaleStatus', 'Normal Activity');
        if (whaleStatus) whaleStatus.style.color = '#888';
        safeUpdateElement('whaleDetails', 'B√ºy√ºk emir tespit edilmedi');
    }
    
    return { detected: whaleDetected, type: whaleType, size: whaleSize };
}

function calculateSupportResistance() {
    if (priceHistory.length < 50) return;
    
    const recent = priceHistory.slice(-100);
    const peaks = [];
    const valleys = [];
    
    // Basit peak/valley detection
    for (let i = 2; i < recent.length - 2; i++) {
        if (recent[i] > recent[i-1] && recent[i] > recent[i+1] && 
            recent[i] > recent[i-2] && recent[i] > recent[i+2]) {
            peaks.push(recent[i]);
        }
        if (recent[i] < recent[i-1] && recent[i] < recent[i+1] && 
            recent[i] < recent[i-2] && recent[i] < recent[i+2]) {
            valleys.push(recent[i]);
        }
    }
    
    // En yakƒ±n seviyeleri bul
    const currentPrice = lastPrice;
    const nearSupport = valleys.filter(v => v < currentPrice).sort((a, b) => b - a)[0];
    const nearResistance = peaks.filter(p => p > currentPrice).sort((a, b) => a - b)[0];
    
    supportResistanceLevels.support = valleys.sort((a, b) => b - a);
    supportResistanceLevels.resistance = peaks.sort((a, b) => a - b);
    supportResistanceLevels.lastCalculated = Date.now();
    
    // UI g√ºncelle
    safeUpdateElement('nearSupport', nearSupport ? formatPrice(nearSupport) : '-');
    safeUpdateElement('nearResistance', nearResistance ? formatPrice(nearResistance) : '-');
    
    // Break probability hesapla
    let breakProb = 'D√º≈ü√ºk';
    if (nearResistance && (currentPrice / nearResistance) > 0.98) breakProb = 'Y√ºksek';
    else if (nearSupport && (currentPrice / nearSupport) < 1.02) breakProb = 'Y√ºksek';
    else if (nearResistance && (currentPrice / nearResistance) > 0.95) breakProb = 'Orta';
    
    safeUpdateElement('breakProbability', breakProb);
}

function startAILearning() {
    debugLog('üß† AI √∂ƒürenme sistemi ba≈ülatƒ±ldƒ±', 'success');
    loadAIData();
    
    // AI progress g√ºncellemesini ba≈ülat
    setInterval(updateAIProgress, 2000);
}

function updateAIProgress() {
    const processed = aiLearningData.totalProcessed;
    const progress = Math.min((processed / 1000) * 100, 100);
    
    aiLearningData.learningProgress = progress;
    
    // UI g√ºncelle
    safeUpdateElement('processedData', processed.toLocaleString());
    safeUpdateElement('learningProgress', `${progress.toFixed(1)}%`);
    
    // AI score hesapla
    const totalSignals = Object.values(aiLearningData.strategies).reduce((sum, s) => sum + s.total, 0);
    const successfulSignals = Object.values(aiLearningData.strategies).reduce((sum, s) => sum + s.success, 0);
    
    if (totalSignals > 0) {
        const successRate = successfulSignals / totalSignals;
        const avgProfit = Object.values(aiLearningData.strategies)
            .flatMap(s => s.profits)
            .reduce((sum, p) => sum + p, 0) / Math.max(1, successfulSignals);
        
        aiLearningData.performanceScore = Math.round((successRate * 70) + Math.max(0, avgProfit * 30));
    }
    
    safeUpdateElement('aiScore', aiLearningData.performanceScore);
    
    // √ñƒürenme hƒ±zƒ±nƒ± g√ºncelle
    const learningSpeed = botSettings.learningSpeed;
    safeUpdateElement('learningRate', 
        learningSpeed === 'fast' ? 'Hƒ±zlƒ±' : learningSpeed === 'slow' ? 'Yava≈ü' : 'Orta');
}

function learnFromSignal(signal, result, profit) {
    const strategy = aiLearningData.strategies[signal.strategy];
    if (!strategy) return;
    
    strategy.total++;
    if (result === 'TP') {
        strategy.success++;
        strategy.profits.push(profit);
    } else {
        strategy.profits.push(-Math.abs(profit));
    }
    
    if (signal.duration) {
        strategy.times.push(signal.duration);
    }
    
    // Array boyutlarƒ±nƒ± sƒ±nƒ±rla
    if (strategy.profits.length > 50) strategy.profits.shift();
    if (strategy.times.length > 50) strategy.times.shift();
    
    // Adaptif e≈üik g√ºncelleme
    if (botSettings.adaptiveThresholds) {
        adaptThresholds(signal.strategy, result, profit);
    }
    
    // Verileri kaydet
    saveAIData();
    updateStrategyPerformanceUI();
    
    debugLog(`üß† AI √∂ƒürendi: ${signal.strategy} ${result} (${profit.toFixed(2)}%)`, 'success');
}

function adaptThresholds(strategy, result, profit) {
    const strategyData = aiLearningData.strategies[strategy];
    const recentResults = strategyData.profits.slice(-10);
    
    if (recentResults.length < 5) return;
    
    const successCount = recentResults.filter(p => p > 0).length;
    const successRate = successCount / recentResults.length;
    
    // Ba≈üarƒ± oranƒ±na g√∂re e≈üikleri ayarla
    if (successRate < 0.4) {
        // Ba≈üarƒ±sƒ±zsa e≈üikleri sƒ±kƒ±la≈ütƒ±r
        if (strategy === 'volume' && botSettings.volumeThreshold < 4.0) {
            botSettings.volumeThreshold += 0.1;
            debugLog(`üîß Volume e≈üiƒüi artƒ±rƒ±ldƒ±: ${botSettings.volumeThreshold.toFixed(1)}x`, 'info');
        }
        if (botSettings.minConfidence < 90) {
            botSettings.minConfidence += 2;
            debugLog(`üîß G√ºven e≈üiƒüi artƒ±rƒ±ldƒ±: ${botSettings.minConfidence}%`, 'info');
        }
    } else if (successRate > 0.7) {
        // Ba≈üarƒ±lƒ±ysa e≈üikleri gev≈üet
        if (strategy === 'volume' && botSettings.volumeThreshold > 1.5) {
            botSettings.volumeThreshold -= 0.05;
            debugLog(`üîß Volume e≈üiƒüi azaltƒ±ldƒ±: ${botSettings.volumeThreshold.toFixed(1)}x`, 'info');
        }
        if (botSettings.minConfidence > 60) {
            botSettings.minConfidence -= 1;
            debugLog(`üîß G√ºven e≈üiƒüi azaltƒ±ldƒ±: ${botSettings.minConfidence}%`, 'info');
        }
    }
    
    // UI'yi g√ºncelle
    updateSettingsUI();
}

function saveAIData() {
    try {
        localStorage.setItem('aiLearningData_v4', JSON.stringify(aiLearningData));
        localStorage.setItem('supportResistanceLevels', JSON.stringify(supportResistanceLevels));
    } catch (error) {
        debugLog(`‚ùå AI veri kaydetme hatasƒ±: ${error.message}`, 'error');
    }
}

function loadAIData() {
    try {
        const saved = localStorage.getItem('aiLearningData_v4');
        if (saved) {
            const loaded = JSON.parse(saved);
            aiLearningData = { ...aiLearningData, ...loaded };
            debugLog(`üìä AI verileri y√ºklendi: ${aiLearningData.totalProcessed} i≈ülem`, 'success');
        }
        
        const savedSR = localStorage.getItem('supportResistanceLevels');
        if (savedSR) {
            supportResistanceLevels = JSON.parse(savedSR);
        }
    } catch (error) {
        debugLog(`‚ùå AI veri y√ºkleme hatasƒ±: ${error.message}`, 'error');
    }
}

function analyzeForSignals(price, volume) {
    if (!orderBookData.bids.length || volumeHistory.length < 10) return;
    
    const analysis = analyzeOrderBook();
    const avgVolume = volumeHistory.reduce((a, b) => a + b, 0) / volumeHistory.length;
    const volumeSpike = volume / avgVolume;
    
    // Strateji analizi
    const signals = [
        analyzeWhaleStrategy(analysis, volumeSpike),
        analyzeImbalanceStrategy(analysis, volumeSpike),
        analyzeVolumeStrategy(analysis, volumeSpike),
        analyzeSRStrategy(analysis, price)
    ].filter(s => s && s.confidence >= botSettings.minConfidence);
    
    // En y√ºksek g√ºvenli sinyali se√ß
    if (signals.length > 0) {
        const bestSignal = signals.sort((a, b) => b.confidence - a.confidence)[0];
        generateSignal(bestSignal);
    }
}

function analyzeWhaleStrategy(analysis, volumeSpike) {
    const whaleData = detectWhaleActivity(analysis);
    
    if (!whaleData.detected || whaleData.size < analysis.bidVolume * 2) return null;
    
    const confidence = Math.min(95, 
        50 + (whaleData.size / analysis.bidVolume * 10) + (volumeSpike * 5)
    );
    
    return {
        strategy: 'whale',
        direction: whaleData.type === 'BUY' ? 'buy' : 'sell',
        confidence,
        reason: `Whale ${whaleData.type}: ${whaleData.size.toFixed(2)}`,
        whaleSize: whaleData.size
    };
}

function analyzeImbalanceStrategy(analysis, volumeSpike) {
    if (Math.abs(analysis.imbalance) < 25) return null;
    
    const confidence = Math.min(90, 
        45 + Math.abs(analysis.imbalance) + (volumeSpike * 8)
    );
    
    return {
        strategy: 'imbalance',
        direction: analysis.imbalance > 0 ? 'buy' : 'sell',
        confidence,
        reason: `OrderBook imbalance: ${analysis.imbalance.toFixed(1)}%`,
        imbalance: analysis.imbalance
    };
}

function analyzeVolumeStrategy(analysis, volumeSpike) {
    if (volumeSpike < botSettings.volumeThreshold) return null;
    
    const confidence = Math.min(85, 
        40 + (volumeSpike * 12) + Math.abs(analysis.imbalance / 2)
    );
    
    // Volume y√∂n√ºn√º orderbook ile belirle
    const direction = analysis.imbalance > 5 ? 'buy' : analysis.imbalance < -5 ? 'sell' : null;
    if (!direction) return null;
    
    return {
        strategy: 'volume',
        direction,
        confidence,
        reason: `Volume spike: ${volumeSpike.toFixed(1)}x`,
        volumeSpike
    };
}

function analyzeSRStrategy(analysis, price) {
    const nearSupport = supportResistanceLevels.support.find(s => s < price && (price - s) / price < 0.02);
    const nearResistance = supportResistanceLevels.resistance.find(r => r > price && (r - price) / price < 0.02);
    
    let signal = null;
    
    // Support bounce
    if (nearSupport && price <= nearSupport * 1.005 && analysis.bidPressure > 60) {
        signal = {
            strategy: 'sr',
            direction: 'buy',
            confidence: Math.min(80, 55 + analysis.bidPressure / 2),
            reason: `Support bounce: ${formatPrice(nearSupport)}`,
            level: nearSupport
        };
    }
    
    // Resistance break
    if (nearResistance && price >= nearResistance * 0.995 && analysis.bidPressure > 55) {
        signal = {
            strategy: 'sr',
            direction: 'buy',
            confidence: Math.min(85, 50 + analysis.bidPressure / 2),
            reason: `Resistance break: ${formatPrice(nearResistance)}`,
            level: nearResistance
        };
    }
    
    return signal;
}

function generateSignal(signalData) {
    const tpPercent = botSettings.takeProfitPercent / 100;
    const slPercent = botSettings.stopLossPercent / 100;
    
    let takeProfit, stopLoss;
    
    if (signalData.direction === 'buy') {
        takeProfit = lastPrice * (1 + tpPercent);
        stopLoss = lastPrice * (1 - slPercent);
    } else {
        takeProfit = lastPrice * (1 - tpPercent);
        stopLoss = lastPrice * (1 + slPercent);
    }
    
    const signal = {
        id: Date.now(),
        strategy: signalData.strategy,
        direction: signalData.direction,
        entryPrice: lastPrice,
        takeProfit,
        stopLoss,
        confidence: signalData.confidence,
        timestamp: Date.now(),
        reason: signalData.reason,
        status: 'active',
        ...signalData
    };
    
    activeSignal = signal;
    lastSignalTime = Date.now();
    
    updateSignalDisplay(signal);
    
    debugLog(`üéØ ${signalData.strategy.toUpperCase()} ${signalData.direction.toUpperCase()}: ${signalData.confidence.toFixed(0)}% - ${signalData.reason}`, 'success');
    showToast(`üéØ ${signalData.direction.toUpperCase()} Sinyali (${signalData.strategy}): %${signalData.confidence.toFixed(0)}`, 'success');
}

function checkActiveSignal(currentPrice) {
    if (!activeSignal || activeSignal.status !== 'active') return;
    
    const signal = activeSignal;
    let signalCompleted = false;
    let result = '';
    
    if (signal.direction === 'buy') {
        if (currentPrice >= signal.takeProfit) {
            result = 'TP';
            signalCompleted = true;
        } else if (currentPrice <= signal.stopLoss) {
            result = 'SL';
            signalCompleted = true;
        }
    } else {
        if (currentPrice <= signal.takeProfit) {
            result = 'TP';
            signalCompleted = true;
        } else if (currentPrice >= signal.stopLoss) {
            result = 'SL';
            signalCompleted = true;
        }
    }
    
    if (signalCompleted) {
        completeSignal(signal, currentPrice, result);
    }
}

function completeSignal(signal, exitPrice, result) {
    signal.status = 'completed';
    signal.exitPrice = exitPrice;
    signal.exitTime = Date.now();
    signal.result = result;
    signal.duration = signal.exitTime - signal.timestamp;
    
    // Kar/zarar hesapla - DOƒûRU HESAPLAMA
    let profitPercent = 0;
    if (signal.direction === 'buy') {
        profitPercent = ((exitPrice - signal.entryPrice) / signal.entryPrice) * 100;
    } else {
        profitPercent = ((signal.entryPrice - exitPrice) / signal.entryPrice) * 100;
    }
    
    // SL durumunda negatif yap
    if (result === 'SL') {
        profitPercent = -Math.abs(profitPercent);
    }
    
    signal.profitPercent = profitPercent;
    
    // AI'ye √∂ƒüret
    learnFromSignal(signal, result, profitPercent);
    
    // Ge√ßmi≈üe ekle
    signalHistory.unshift(signal);
    if (signalHistory.length > 100) signalHistory.pop();
    
    // Kaydet
    saveSignalHistory();
    
    // UI g√ºncelle
    clearSignalDisplay();
    updateSignalHistory();
    
    const resultIcon = result === 'TP' ? '‚úÖ' : 'üõë';
    const resultText = result === 'TP' ? 'Take Profit' : 'Stop Loss';
    
    debugLog(`${resultIcon} ${signal.strategy.toUpperCase()} ${signal.direction.toUpperCase()} ${resultText}: ${profitPercent.toFixed(2)}%`, 
        result === 'TP' ? 'success' : 'warning');
    showToast(`${resultIcon} ${resultText}: ${profitPercent.toFixed(2)}% (${signal.strategy})`, 
        result === 'TP' ? 'success' : 'warning');
    
    activeSignal = null;
}

function updateSignalDisplay(signal) {
    const signalBox = document.getElementById('currentSignal');
    if (!signalBox) return;
    
    const duration = Math.floor((Date.now() - signal.timestamp) / 1000);
    
    signalBox.className = `signal-box ${signal.direction}`;
    signalBox.innerHTML = `
        <div style="font-weight: 700; margin-bottom: 8px; display: flex; justify-content: space-between;">
            <span>${signal.direction.toUpperCase()} Sinyali</span>
            <span style="font-size: 0.8rem; color: #4ECDC4;">%${signal.confidence.toFixed(0)}</span>
        </div>
        <div style="font-size: 0.8rem; color: #ccc; margin-bottom: 6px;">
            ${signal.reason}
        </div>
    `;
    
    const confidenceBar = document.getElementById('confidenceBar');
    if (confidenceBar) confidenceBar.style.width = `${signal.confidence}%`;
    
    safeUpdateElement('confidencePercent', `${signal.confidence.toFixed(0)}%`);
    safeUpdateElement('entryPrice', formatPrice(signal.entryPrice));
    safeUpdateElement('currentStrategy', signal.strategy.toUpperCase());
    safeUpdateElement('tpPrice', formatPrice(signal.takeProfit));
    safeUpdateElement('slPrice', formatPrice(signal.stopLoss));
    safeUpdateElement('signalDuration', `${duration}s`);
    
    // OrderBook g√ºc√º g√∂ster
    const strength = signal.whaleSize ? 'Whale' : 
                   signal.imbalance ? `${Math.abs(signal.imbalance).toFixed(0)}%` : 
                   signal.volumeSpike ? `${signal.volumeSpike.toFixed(1)}x` : 'Normal';
    safeUpdateElement('orderbookStrength', strength);
    
    // AI √∂nerisi
    let recommendation = 'ƒ∞zle';
    if (signal.confidence > 85) recommendation = 'G√º√ßl√º';
    else if (signal.confidence > 75) recommendation = 'ƒ∞yi';
    else if (signal.confidence < 65) recommendation = 'Dikkatli';
    
    safeUpdateElement('aiRecommendation', recommendation);
}

function clearSignalDisplay() {
    const signalBox = document.getElementById('currentSignal');
    if (signalBox) {
        signalBox.className = 'signal-box';
        signalBox.innerHTML = `
            <div style="font-weight: 700; margin-bottom: 8px;">‚è≥ Sinyal Bekleniyor...</div>
            <div style="font-size: 0.8rem; color: #888;">AI OrderBook analizi yapƒ±yor</div>
        `;
    }
    
    const confidenceBar = document.getElementById('confidenceBar');
    if (confidenceBar) confidenceBar.style.width = '0%';
    
    safeUpdateElement('confidencePercent', '0%');
    safeUpdateElement('entryPrice', '-');
    safeUpdateElement('currentStrategy', '-');
    safeUpdateElement('tpPrice', '-');
    safeUpdateElement('slPrice', '-');
    safeUpdateElement('signalDuration', '-');
    safeUpdateElement('orderbookStrength', '-');
    safeUpdateElement('aiRecommendation', 'Bekliyor');
}

function updateSignalHistory() {
    const historyDiv = document.getElementById('signalHistory');
    if (!historyDiv) return;
    
    if (signalHistory.length === 0) {
        historyDiv.innerHTML = '<div style="text-align: center; color: #888; font-size: 0.8rem; padding: 20px;">Sinyal ge√ßmi≈üi burada g√∂r√ºnecek</div>';
        return;
    }

    historyDiv.innerHTML = signalHistory.slice(0, 15).map(s => {
        const profit = s.profitPercent || 0;
        const color = profit >= 0 ? '#00D4AA' : '#F84960';
        const time = new Date(s.timestamp).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        const duration = s.duration ? `${Math.floor(s.duration / 1000)}s` : '-';
        
        return `
            <div style="padding: 8px; font-size: 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.1); border-left: 3px solid ${color}; margin-bottom: 4px; border-radius: 4px; background: rgba(255,255,255,0.02);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 600;">[${time}] ${s.direction.toUpperCase()}</span>
                    <span style="color: ${color}; font-weight: 700;">${s.result}: ${profit.toFixed(2)}%</span>
                </div>
                <div style="font-size: 0.7rem; color: #888; margin-top: 3px;">
                    ${s.strategy.toUpperCase()} | ${formatPrice(s.entryPrice)} ‚Üí ${formatPrice(s.exitPrice || 0)} | ${duration}
                </div>
                <div style="font-size: 0.65rem; color: #666; margin-top: 2px;">
                    ${s.reason || 'Sinyal nedeni belirtilmemi≈ü'}
                </div>
            </div>
        `;
    }).join('');

    updatePerformanceStats();
    updateDailyStats();
}

function updatePerformanceStats() {
    const completed = signalHistory.filter(s => s.status === 'completed');
    const successful = completed.filter(s => s.result === 'TP');
    
    safeUpdateElement('totalSignals', completed.length);
    safeUpdateElement('successfulSignals', successful.length);
    
    const successRate = completed.length > 0 ? (successful.length / completed.length * 100) : 0;
    safeUpdateElement('successRate', `${successRate.toFixed(1)}%`);
    
    const avgProfit = completed.length > 0 ? 
        completed.reduce((sum, s) => sum + (s.profitPercent || 0), 0) / completed.length : 0;
    safeUpdateElement('avgProfit', `${avgProfit.toFixed(2)}%`);
}

function updateDailyStats() {
    const today = new Date().toDateString();
    const thisHour = new Date().getHours();
    
    const todaySignals = signalHistory.filter(s => 
        new Date(s.timestamp).toDateString() === today
    ).length;
    
    const hourlySignals = signalHistory.filter(s => {
        const signalDate = new Date(s.timestamp);
        return signalDate.toDateString() === today && signalDate.getHours() === thisHour;
    }).length;
    
    safeUpdateElement('todaySignals', todaySignals);
    safeUpdateElement('hourlySignals', hourlySignals);
}

function updateStrategyPerformanceUI() {
    const strategies = ['whale', 'imbalance', 'volume', 'sr'];
    
    strategies.forEach(strategy => {
        const data = aiLearningData.strategies[strategy];
        const successRate = data.total > 0 ? (data.success / data.total * 100) : 0;
        const avgProfit = data.profits.length > 0 ? 
            data.profits.reduce((a, b) => a + b, 0) / data.profits.length : 0;
        const avgTime = data.times.length > 0 ? 
            data.times.reduce((a, b) => a + b, 0) / data.times.length : 0;
        
        // Element isimlerini g√ºncelle
        const strategyMap = {
            whale: 'whale',
            imbalance: 'imbalance', 
            volume: 'volume',
            sr: 'sr'
        };
        
        const elemName = strategyMap[strategy];
        if (elemName) {
            safeUpdateElement(`${elemName}Strategy`, 
                `${successRate.toFixed(1)}% (${data.success}/${data.total})`);
            safeUpdateElement(`${elemName}AvgProfit`, 
                `${avgProfit.toFixed(2)}%`);
            safeUpdateElement(`${elemName}AvgTime`, 
                avgTime > 0 ? `${Math.floor(avgTime / 1000)}s` : '-');
        }
    });
    
    // En iyi stratejiyi bul
    const bestStrategy = strategies.reduce((best, current) => {
        const currentData = aiLearningData.strategies[current];
        const bestData = aiLearningData.strategies[best];
        
        if (currentData.total === 0) return best;
        if (bestData.total === 0) return current;
        
        const currentRate = currentData.success / currentData.total;
        const bestRate = bestData.success / bestData.total;
        
        return currentRate > bestRate ? current : best;
    }, 'whale');
    
    const bestData = aiLearningData.strategies[bestStrategy];
    if (bestData.total > 0) {
        const successRate = (bestData.success / bestData.total * 100).toFixed(1);
        const avgProfit = bestData.profits.length > 0 ? 
            (bestData.profits.reduce((a, b) => a + b, 0) / bestData.profits.length).toFixed(2) : 0;
        
        safeUpdateElement('bestStrategy', 
            `${bestStrategy.toUpperCase()} - %${successRate} ba≈üarƒ±`);
        safeUpdateElement('bestStrategyDetails', 
            `${bestData.success}/${bestData.total} sinyal | Ortalama: %${avgProfit}`);
    }
}

function saveSignalHistory() {
    try {
        localStorage.setItem('signalHistory_v4', JSON.stringify(signalHistory));
    } catch (error) {
        debugLog(`‚ùå Ge√ßmi≈ü kaydetme hatasƒ±: ${error.message}`, 'error');
    }
}

function loadSignalHistory() {
    try {
        const saved = localStorage.getItem('signalHistory_v4');
        if (saved) {
            signalHistory = JSON.parse(saved);
            updateSignalHistory();
            debugLog(`üìä ${signalHistory.length} sinyal ge√ßmi≈üi y√ºklendi`, 'success');
        }
    } catch (error) {
        debugLog(`‚ùå Ge√ßmi≈ü y√ºkleme hatasƒ±: ${error.message}`, 'error');
    }
}

// Ayarlar fonksiyonlarƒ±
function initializeSettings() {
    // Slider event listeners
    const volumeThreshold = document.getElementById('volumeThreshold');
    if (volumeThreshold) {
        volumeThreshold.addEventListener('input', (e) => {
            botSettings.volumeThreshold = parseFloat(e.target.value);
            safeUpdateElement('volumeThresholdValue', `${e.target.value}x`);
        });
    }
    
    const takeProfitPercent = document.getElementById('takeProfitPercent');
    if (takeProfitPercent) {
        takeProfitPercent.addEventListener('input', (e) => {
            botSettings.takeProfitPercent = parseFloat(e.target.value);
            safeUpdateElement('takeProfitValue', `${e.target.value}%`);
        });
    }
    
    const stopLossPercent = document.getElementById('stopLossPercent');
    if (stopLossPercent) {
        stopLossPercent.addEventListener('input', (e) => {
            botSettings.stopLossPercent = parseFloat(e.target.value);
            safeUpdateElement('stopLossValue', `${e.target.value}%`);
        });
    }
    
    const minConfidence = document.getElementById('minConfidence');
    if (minConfidence) {
        minConfidence.addEventListener('input', (e) => {
            botSettings.minConfidence = parseInt(e.target.value);
            safeUpdateElement('minConfidenceValue', `${e.target.value}%`);
        });
    }
    
    // Select ve checkbox listeners
    const learningSpeed = document.getElementById('learningSpeed');
    if (learningSpeed) {
        learningSpeed.addEventListener('change', (e) => {
            botSettings.learningSpeed = e.target.value;
        });
    }
    
    const autoOptimization = document.getElementById('autoOptimization');
    if (autoOptimization) {
        autoOptimization.addEventListener('change', (e) => {
            botSettings.autoOptimization = e.target.checked;
        });
    }
    
    const adaptiveThresholds = document.getElementById('adaptiveThresholds');
    if (adaptiveThresholds) {
        adaptiveThresholds.addEventListener('change', (e) => {
            botSettings.adaptiveThresholds = e.target.checked;
        });
    }
}

function updateSettingsUI() {
    const volumeThreshold = document.getElementById('volumeThreshold');
    if (volumeThreshold) {
        volumeThreshold.value = botSettings.volumeThreshold;
        safeUpdateElement('volumeThresholdValue', `${botSettings.volumeThreshold}x`);
    }
    
    const takeProfitPercent = document.getElementById('takeProfitPercent');
    if (takeProfitPercent) {
        takeProfitPercent.value = botSettings.takeProfitPercent;
        safeUpdateElement('takeProfitValue', `${botSettings.takeProfitPercent}%`);
    }
    
    const stopLossPercent = document.getElementById('stopLossPercent');
    if (stopLossPercent) {
        stopLossPercent.value = botSettings.stopLossPercent;
        safeUpdateElement('stopLossValue', `${botSettings.stopLossPercent}%`);
    }
    
    const minConfidence = document.getElementById('minConfidence');
    if (minConfidence) {
        minConfidence.value = botSettings.minConfidence;
        safeUpdateElement('minConfidenceValue', `${botSettings.minConfidence}%`);
    }
    
    const learningSpeed = document.getElementById('learningSpeed');
    if (learningSpeed) learningSpeed.value = botSettings.learningSpeed;
    
    const autoOptimization = document.getElementById('autoOptimization');
    if (autoOptimization) autoOptimization.checked = botSettings.autoOptimization;
    
    const adaptiveThresholds = document.getElementById('adaptiveThresholds');
    if (adaptiveThresholds) adaptiveThresholds.checked = botSettings.adaptiveThresholds;
}

function saveSettings() {
    try {
        localStorage.setItem('botSettings_v4', JSON.stringify(botSettings));
        showToast('üíæ Ayarlar kaydedildi', 'success');
        debugLog('üíæ Bot ayarlarƒ± kaydedildi', 'success');
    } catch (error) {
        debugLog(`‚ùå Ayar kaydetme hatasƒ±: ${error.message}`, 'error');
        showToast('‚ùå Ayarlar kaydedilemedi', 'error');
    }
}

function loadSettings() {
    try {
        const saved = localStorage.getItem('botSettings_v4');
        if (saved) {
            botSettings = { ...botSettings, ...JSON.parse(saved) };
            updateSettingsUI();
            debugLog('‚öôÔ∏è Bot ayarlarƒ± y√ºklendi', 'success');
        }
    } catch (error) {
        debugLog(`‚ùå Ayar y√ºkleme hatasƒ±: ${error.message}`, 'error');
    }
}

function resetSettings() {
    if (confirm('T√ºm ayarlarƒ± varsayƒ±lana d√∂nd√ºrmek istediƒüinizden emin misiniz?')) {
        botSettings = {
            volumeThreshold: 2.0,
            takeProfitPercent: 0.8,
            stopLossPercent: 0.5,
            minConfidence: 70,
            signalCooldown: 30000,
            learningSpeed: 'medium',
            autoOptimization: true,
            adaptiveThresholds: true
        };
        updateSettingsUI();
        saveSettings();
        showToast('üîÑ Ayarlar varsayƒ±lana d√∂nd√ºr√ºld√º', 'success');
        debugLog('üîÑ Ayarlar sƒ±fƒ±rlandƒ±', 'info');
    }
}

function resetAI() {
    if (confirm('AI √∂ƒürenme verilerini tamamen sƒ±fƒ±rlamak istediƒüinizden emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
        // AI verilerini sƒ±fƒ±rla
        aiLearningData = {
            totalProcessed: 0,
            learningProgress: 0,
            performanceScore: 0,
            strategies: {
                whale: { total: 0, success: 0, profits: [], times: [] },
                imbalance: { total: 0, success: 0, profits: [], times: [] },
                volume: { total: 0, success: 0, profits: [], times: [] },
                sr: { total: 0, success: 0, profits: [], times: [] }
            }
        };
        
        // Sinyal ge√ßmi≈üini sƒ±fƒ±rla
        signalHistory = [];
        
        // Support/Resistance verilerini sƒ±fƒ±rla
        supportResistanceLevels = {
            support: [],
            resistance: [],
            lastCalculated: 0
        };
        
        // LocalStorage'dan sil
        localStorage.removeItem('aiLearningData_v4');
        localStorage.removeItem('signalHistory_v4');
        localStorage.removeItem('supportResistanceLevels');
        
        // UI'yi g√ºncelle
        updateSignalHistory();
        updateStrategyPerformanceUI();
        updateAIProgress();
        
        showToast('üß† AI verileri sƒ±fƒ±rlandƒ±', 'success');
        debugLog('üß† AI √∂ƒürenme verileri tamamen sƒ±fƒ±rlandƒ±', 'warning');
    }
}

// Tema fonksiyonu
function toggleTheme() {
    const body = document.body;
    const isLightTheme = body.classList.toggle('light-theme');
    localStorage.setItem('theme_v4', isLightTheme ? 'light' : 'dark');
    
    const themeToggle = document.querySelector('.theme-toggle');
    if (themeToggle) {
        themeToggle.textContent = isLightTheme ? 'üåû Tema' : 'üåô Tema';
    }
    
    showToast(`${isLightTheme ? 'üåû A√ßƒ±k' : 'üåô Koyu'} tema aktif`, 'success');
}

function loadTheme() {
    const savedTheme = localStorage.getItem('theme_v4');
    if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        const themeToggle = document.querySelector('.theme-toggle');
        if (themeToggle) themeToggle.textContent = 'üåû Tema';
    }
}

// Yardƒ±mcƒ± fonksiyonlar
function clearHistory() {
    if (confirm('Sinyal ge√ßmi≈üini temizlemek istediƒüinizden emin misiniz?')) {
        signalHistory = [];
        localStorage.removeItem('signalHistory_v4');
        updateSignalHistory();
        showToast('üóëÔ∏è Ge√ßmi≈ü temizlendi', 'success');
        debugLog('üóëÔ∏è Sinyal ge√ßmi≈üi temizlendi', 'info');
    }
}

function exportHistory() {
    try {
        const exportData = {
            signals: signalHistory,
            aiData: aiLearningData,
            settings: botSettings,
            exportDate: new Date().toISOString(),
            version: '4.0'
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `ai_orderbook_bot_data_${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
        
        showToast('üì§ Veriler dƒ±≈üa aktarƒ±ldƒ±', 'success');
        debugLog('üì§ Veriler JSON olarak dƒ±≈üa aktarƒ±ldƒ±', 'success');
    } catch (error) {
        debugLog(`‚ùå Dƒ±≈üa aktarma hatasƒ±: ${error.message}`, 'error');
        showToast('‚ùå Dƒ±≈üa aktarma hatasƒ±', 'error');
    }
}

// Ana ba≈ülatma fonksiyonu
function initializeBot() {
    try {
        debugLog("üöÄ AI OrderBook Sinyal Botu v4.0 ba≈ülatƒ±lƒ±yor...", 'info');
        
        // Verileri y√ºkle
        loadSettings();
        loadSignalHistory();
        loadTheme();
        loadAIData();
        initializeSettings();
        
        // Kaydedilmi≈ü coin varsa y√ºkle
        const savedSymbol = localStorage.getItem('currentSymbol_v4');
        if (savedSymbol) {
            const manualSymbol = document.getElementById('manualSymbol');
            if (manualSymbol) {
                manualSymbol.value = savedSymbol.replace('_USDT', '');
            }
        }
        
        // Otomatik baƒülanma
        if (localStorage.getItem('autoConnect_v4') === 'true' && savedSymbol) {
            setTimeout(connect, 2000);
        }
        
        // Aktif sinyal g√ºncelleme
        setInterval(() => {
            if (activeSignal && activeSignal.status === 'active') {
                updateSignalDisplay(activeSignal);
            }
        }, 1000);
        
        // AI progress g√ºncelleme
        setInterval(updateAIProgress, 3000);
        
        // Strateji performans g√ºncelleme
        setInterval(updateStrategyPerformanceUI, 5000);
        
        // Otomatik kaydetme
        setInterval(() => {
            saveSettings();
            saveAIData();
            saveSignalHistory();
        }, 60000);
        
        debugLog("‚úÖ Bot ba≈üarƒ±yla ba≈ülatƒ±ldƒ±", 'success');
        showToast("üöÄ AI OrderBook Bot hazƒ±r!", 'success');
        
    } catch (error) {
        debugLog(`‚ùå Bot ba≈ülatma hatasƒ±: ${error.message}`, 'error');
        showToast('‚ùå Ba≈ülatma hatasƒ±', 'error');
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    initializeBot();
    
    // Coin input event
    const manualSymbol = document.getElementById('manualSymbol');
    if (manualSymbol) {
        manualSymbol.addEventListener('input', (e) => {
            const coin = e.target.value.trim().toUpperCase();
            if (coin) {
                localStorage.setItem('currentSymbol_v4', coin + '_USDT');
                localStorage.setItem('autoConnect_v4', 'true');
            }
        });
    }
    
    // Sayfa kapatƒ±lƒ±rken kaydet
    window.addEventListener('beforeunload', () => {
        saveSettings();
        saveAIData();
        saveSignalHistory();
    });
    
    // Klavye kƒ±sayollarƒ±
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'Enter':
                    e.preventDefault();
                    toggleConnection();
                    break;
                case 's':
                    e.preventDefault();
                    saveSettings();
                    break;
                case 'r':
                    e.preventDefault();
                    if (e.shiftKey) resetAI();
                    break;
                case 'e':
                    e.preventDefault();
                    exportHistory();
                    break;
            }
        }
    });
});

// Ba≈ülatma mesajlarƒ±
setTimeout(() => {
    debugLog("üéâ AI OrderBook Sinyal Botu v4.0 hazƒ±r!", 'success');
    debugLog("üß† Geli≈ümi≈ü AI √∂ƒürenme sistemi aktif", 'info');
    debugLog("üìä 4 strateji: Whale, Imbalance, Volume, Support/Resistance", 'info');
    debugLog("‚ö° Ctrl+Enter: Baƒülan | Ctrl+S: Kaydet | Ctrl+Shift+R: AI Sƒ±fƒ±rla", 'info');
    debugLog("üîß MEXC Futures WebSocket ile hassas fiyat desteƒüi", 'info');
    debugLog("üíæ Kalƒ±cƒ± hafƒ±za: T√ºm veriler otomatik kaydediliyor", 'success');
}, 1500);
</script>
    </script>
</body>
</html>
